#!/usr/bin/env bash
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
PROG="hostname"
USER="${SUDO_USER:-${USER}}"
HOME="${USER_HOME:-${HOME}}"
SRC_DIR="${BASH_SOURCE%/*}"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#set opts

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version       : 031120210730-git
# @Author        : Jason Hempstead
# @Contact       : jason@casjaysdev.com
# @License       : WTFPL
# @ReadME        : hostname --help
# @Copyright     : Copyright: (c) 2021 Jason Hempstead, CasjaysDev
# @Created       : Thursday, Mar 11, 2021 07:30 EST
# @File          : hostname
# @Description   : Set system hostname
# @TODO          :
# @Other         :
# @Resource      :
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Main function
__version() { app_version; }
__help() {
  app_help "usage: hostname" \
    "-f                     -  display full hostname" \
    "-s                     -  display short hostname" \
    "-d                     -  display domain name" \
    "-v, --version          -  display version" \
    "-h, --help             -  display help"
}
main() {
  if [ -f "$SRC_DIR/functions.bash" ]; then local DIR="$SRC_DIR"; else local DIR="$HOME/.local/bin"; fi
  if [[ -f "$DIR/functions.bash" ]]; then
    . "$DIR/functions.bash"
  else
    printf "\t\t\\033[0;31m%s \033[0m\n" "Couldn't source the functions file from $DIR"
    return 1
  fi
  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  case $1 in
    -v | --version) __version ;;
    -h | --help) __help ;;
  esac
  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  __hostname() {
    local PATH="/usr/bin:/usr/sbin:/bin:/sbin:/usr/local/bin"
    if [ -f "$(command -v hostname 2>/dev/null)" ]; then
      local hostnamecmd="$(command -p hostname "-f" 2>/dev/null)"
      local hostnamefcmd="(command -p hostname "-f" 2>/dev/null)"
      local hostnamescmd="(command -p hostname "-s" 2>/dev/null)"
      if [[ "$hostnamecmd" =~ .local$ ]]; then local hostnamedcmd="local"; else
        local hostnamedcmd="(command -p hostname "-d" 2>/dev/null)"; fi
      [ -f ~/.cache/hostname/name ] || echo "$hostnamecmd" >~/.cache/hostname/name
      [ -f ~/.cache/hostname/full ] || echo "$hostnamefcmd" >~/.cache/hostname/full
      [ -f ~/.cache/hostname/short ] || echo "$hostnamescmd" >~/.cache/hostname/short
      [ -f ~/.cache/hostname/domain ] || echo "$hostnamescmd" >~/.cache/hostname/domain
      command -p hostname "$@" 2>/dev/null
    elif [ -f "$(command -v hostnamectl 2>/dev/null)" ]; then
      shift $#
      local hostnamecmd="$(command -p hostnamectl | grep 'hostname:' | awk '{print $3}' 2>/dev/null)"
      local hostnamefcmd="(command -p hostnamectl | grep 'hostname:' | awk '{print $3}' 2>/dev/null)"
      local hostnamescmd="(command -p hostnamectl | grep 'hostname:' | awk '{print $3}' | sed 's#\..*##g'2>/dev/null)"
      if [[ "$hostnamecmd" =~ .local$ ]]; then local hostnamedcmd="local"; else
        local hostnamedcmd="$(command -p hostnamectl | grep 'hostname:' | awk -F. '{print $(NF-1) "." $NF}' 2>/dev/null)";
      fi
      [ -f ~/.cache/hostname/name ] || command -p hostnamectl | grep 'hostname:' | awk '{print $3}' >~/.cache/hostname/name
      [ -f ~/.cache/hostname/full ] || command -p  >~/.cache/hostname/full
      [ -f ~/.cache/hostname/short ] || command -p hostname "-s" >~/.cache/hostname/short
      command -p hostnamectl 2>/dev/null | grep 'hostname:' | awk '{print $3}'
    fi
  }
  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  # Set additional variables
  mkdir -p "$HOME/.cache/hostname" &>/dev/null
  if [ -f /etc/hostname ]; then
    hostname="$(</etc/hostname)"
  elif [ -f ~/.cache/hostname/name ]; then
    hostname="$(<~/.cache/hostname/name)"
  else
    hostname=""
  fi
  [ -f ~/.cache/hostname/full ] && hostnamef="$(<~/.cache/hostname/full)" || hostnamef=""
  [ -f ~/.cache/hostname/short ] && hostnames="$(<~/.cache/hostname/short)" || hostnames=""
  [ -f ~/.cache/hostname/domain ] && hostnamed="$(<~/.cache/hostname/domain)" || hostnamed=""
  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  # Main application
  case "$1" in
  -f)
    shift 1
    [ -n "$hostnamef" ] && echo $hostnamef || __hostname "-f"
    ;;

  -s)
    shift 1
    [ -n "$hostnames" ] && echo $hostnames || __hostname "-s"
    ;;
  -d)
    shift 1
    [ -n "$hostnamed" ] && echo $hostnamed || __hostname "-d"
    ;;
  *)
    [ -n "$hostname" ] && echo $hostname || __hostname "$@"
    ;;
  esac
}
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
main "$@"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
exit $?
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# end

